# 心动小镇自动烹饪脚本

这是一个用于心动小镇游戏的自动烹饪脚本，能够自动识别并点击烹饪界面的菜单按钮、食物按钮、开始按钮和完成按钮，实现自动化烹饪流程。

## 新增功能

- **自动切换窗口**：程序启动时会自动查找并切换到"心动小镇"窗口
- **窗口状态检测**：在每次操作前检查游戏窗口是否在前台，如果不在则重新激活
- **更强的点击验证**：点击菜单按钮后会验证是否成功进入食物选择界面
- **错误恢复机制**：当点击无效时，会尝试重新激活窗口并双击按钮
- **更长的等待时间**：增加了点击操作后的等待时间，提高成功率

## 系统要求

- Windows 10/11
- Python 3.8 或更高版本
- 安装所有依赖包

## 安装步骤

1. 确保已安装Python 3.8+
2. 下载或克隆本仓库
3. 安装依赖：
   ```
   pip install -r requirements.txt
   ```

## 使用方法

1. 打开心动小镇游戏，确保游戏窗口已启动并可见
2. 打开命令提示符/PowerShell，进入程序目录
3. 执行以下命令启动脚本：
   ```
   python start.py --food 葡萄酱 --loop 5
   ```
   
   参数说明：
   - `--food`：指定要制作的食物名称，默认为"葡萄酱"
   - `--loop`：指定循环次数，设为-1表示无限循环，默认为1

4. 程序启动后会自动查找并切换到心动小镇窗口
5. 使用Ctrl+Q可以随时退出程序

## 可用食物

目前支持的食物有：
- 葡萄酱
- 提拉米苏
- 紫色浮云卷
- sala

## 问题排查

如果点击按钮没有效果，可能的原因有：

1. 游戏窗口未被正确识别或激活
   - 确保游戏窗口标题包含"心动小镇"
   
2. 游戏分辨率与脚本不匹配
   - 可以尝试修改游戏分辨率或调整模板图像

3. 游戏界面有变化
   - 若游戏更新后界面有变化，可能需要更新模板图像

## 注意事项

- 请确保在运行脚本时不要移动鼠标或使用键盘，以免干扰自动操作
- 脚本运行期间，不要最小化或切换游戏窗口
- 如需定制其他食物，请将对应的食物图标截图保存到foods目录下

# 拼图识别工具

这是一个自动识别拼图并标识位置的Python脚本，可以帮助你快速找到拼图图块应该放置的位置。

## 🚀 快速开始

### 1. 安装依赖

```bash
pip install -r puzzle_requirements.txt
```

### 2. 运行程序

**推荐方式：使用启动脚本**
```bash
python run_puzzle_solver.py
```

**直接运行：**
```bash
# 简化版本（推荐新手）
python simple_puzzle_solver.py

# 完整版本（支持配置保存）
python pintu.py

# 功能测试
python test_puzzle.py
```

## 功能特点

- 🖼️ 自动截图识别拼图界面
- 🖱️ 手动选择拼图区域、完整图片区域和图块区域
- 🔍 使用模板匹配算法找到图块在完整图片中的位置
- 📍 在拼图区域标记每个图块应该放置的位置
- 🎨 根据匹配置信度显示不同颜色的标记框
- 💾 支持配置保存和加载（完整版本）
- 🧪 内置功能测试

## 使用方法

### 方法一：使用启动脚本（推荐）

1. 运行启动脚本：
   ```bash
   python run_puzzle_solver.py
   ```

2. 选择功能：
   - 选择 `1` 运行简化版本
   - 选择 `2` 运行完整版本
   - 选择 `3` 运行功能测试
   - 选择 `4` 查看帮助

### 方法二：直接运行

#### 简化版本（推荐新手）

```bash
python simple_puzzle_solver.py
```

#### 完整版本（支持配置保存）

```bash
python pintu.py
```

## 📋 使用步骤

1. **准备拼图界面**
   - 打开拼图游戏
   - 点击第一个按钮显示完整图片
   - 确保拼图区域（黄色区域）和图块都可见

2. **运行脚本**
   - 脚本会显示一个截图按钮窗口
   - 点击"点击截图"按钮开始截图
   - 脚本会自动截取当前屏幕

3. **选择区域**
   - **拼图区域**：点击黄色拼图区域的左上角和右下角
   - **完整图片区域**：点击完整图片的左上角和右下角
   - **图块区域**：依次点击每个图块的左上角和右下角，完成后按 'q' 键

4. **查看结果**
   - 脚本会显示两个窗口：
     - 完整图片匹配结果：显示图块在完整图片中的位置
     - 拼图区域标记：显示图块在拼图区域中应该放置的位置

## 🖱️ 截图按钮功能

- **可视化界面**：不再需要按回车键，而是显示一个直观的截图按钮
- **点击触发**：点击按钮即可开始截图，更加用户友好
- **状态提示**：按钮会显示当前状态和操作提示

## 🎨 结果说明

- **🟢 绿色框**：高置信度匹配 (>0.8) - 位置很准确
- **🟡 黄色框**：中等置信度匹配 (0.6-0.8) - 位置较准确
- **🔴 红色框**：低置信度匹配 (<0.6) - 位置可能不准确

## 📁 文件说明

- `run_puzzle_solver.py` - 🚀 启动脚本（推荐使用）
- `simple_puzzle_solver.py` - 🎯 简化版本（适合新手）
- `pintu.py` - 🔧 完整版本（支持配置保存）
- `test_puzzle.py` - 🧪 功能测试脚本
- `puzzle_requirements.txt` - 📦 依赖管理文件
- `puzzle_config.txt` - ⚙️ 配置文件（自动生成）

## ⚠️ 注意事项

1. 确保拼图界面清晰可见，没有遮挡
2. 选择区域时要尽量准确，避免包含多余的内容
3. 如果匹配效果不好，可以尝试重新选择区域
4. 脚本使用OpenCV的模板匹配算法，对于相似的图块可能会有误匹配
5. 首次使用建议先运行功能测试

## 🔧 技术原理

1. **📸 截图**：使用 `pyautogui` 截取屏幕
2. **🖱️ 区域选择**：通过鼠标点击选择感兴趣的区域
3. **🔍 模板匹配**：使用OpenCV的 `matchTemplate` 函数进行图像匹配
4. **📐 坐标映射**：将完整图片中的位置映射到拼图区域
5. **🎨 可视化**：在图像上绘制标记框和标签

## 🛠️ 故障排除

- **❌ 无法识别图块**：检查图块区域选择是否准确
- **❌ 匹配位置错误**：尝试重新选择完整图片区域
- **❌ 置信度低**：确保图块和完整图片清晰，没有压缩或变形
- **❌ 依赖安装失败**：尝试手动安装：`pip install opencv-python numpy pyautogui`

## 🎯 使用技巧

1. **提高匹配精度**：
   - 选择图块时尽量只包含图块本身，避免背景
   - 确保完整图片清晰，没有模糊或压缩

2. **快速使用**：
   - 使用完整版本可以保存配置，下次直接使用
   - 对于相同布局的拼图，配置可以重复使用

3. **处理特殊情况**：
   - 如果图块有旋转，可能需要手动调整
   - 对于颜色相似的图块，注意查看置信度 